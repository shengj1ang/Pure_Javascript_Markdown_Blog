---
date: '2022-06-02T18:16:00.021+01:00'
description: ''
published: true
slug: 2022-06-notes-of-operations-in-r2s-in-2022
tags:
- http://schemas.google.com/blogger/2008/kind#post
- legacy-blogger
time_to_read: 5
title: "\u8BB0\u5F55\u4E0B\u5728R2S\u4E0A\u5B89\u88C5lnmp\u7684\u8FC7\u7A0B"
---

*This was originally posted on blogger [here](https://sheng-jiang.blogspot.com/2022/06/notes-of-operations-in-r2s-in-2022.html)*.

<p>&nbsp;前言：</p><p>两年前（2020）入手的R2S，大多数人买了是当软路由用的，我直接当成树莓派用。这个相比于Danny的树莓派，在我记忆中，安装起来除了很慢，也没遇到什么问题。我只装了宝塔面板+Nginx+PHP7.1+可道云(主要就用个WebDAV)&amp;其它的一些网站，花了能有一天。</p><p>现在（2022），一是宝塔最近名声不大好，二是这台R2S里面已经很乱了，三是WebDAV我有更稳定长久的方法代替了，完全不需要可道云了，以后我也不会用基于PHP的文件管理系统了，实在是太不底层了。所以促使了这次重装。</p><p>这次重装我打算直接装lnmp，其实不装数据库。</p><p>&nbsp;1. Download Image and flash:<a href="https://wiki.friendlyelec.com/wiki/index.php/NanoPi_R2S" target="_blank"> https://wiki.friendlyelec.com/wiki/index.php/NanoPi_R2S</a></p><p>&nbsp;2. Better change the passwords of pi &amp; root account: passwd</p><p>&nbsp;3. 更新时间，系统时间停留在2020年，所以我两年前完全没问题。现在，这里我花了大半天，我本以为是apt源的问题，害得我把系统刷了2遍，又换源，还把宝塔的脚本也试了一下，最后试wget的时候发现报证书错误，才反应过来是时间问题。 这个证书真的是大无语。</p><p><br /></p><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="border: 0px; color: #656d78; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"><li class="L0" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">rm </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">-</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">rf </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">etc</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">localtime</span></li><li class="L1" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">ln </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">-</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">s </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">usr</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">share</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">zoneinfo</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="typ" style="border: 0px; color: #4fc1e9; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">Asia</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="typ" style="border: 0px; color: #4fc1e9; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">Shanghai</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"> </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">etc</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">/</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">localtime</span></li></ol></pre><div style="border: 0px; line-height: 28px; margin: 0px 0px 20px; padding: 0px; text-align: left; vertical-align: baseline;"><span style="font-size: 20px;">NTP同步时间 协议（可选择跳过）<br /></span><span style="font-size: 20px;">众所周知，NTP协议是网络时间同步协议，有了它，我们可以很轻松的同步本地时间与互联网时间。VPS上也可以使用NTP来同步网络。首先安装必要的软件包：<br /></span><span style="font-size: 20px;">Ubuntu/Debian系统</span></div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="border: 0px; color: #656d78; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"><li class="L0" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">apt</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">-</span><span class="kwd" style="border: 0px; color: #4fc1e9; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">get</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"> update</span></li><li class="L1" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">apt</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">-</span><span class="kwd" style="border: 0px; color: #4fc1e9; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">get</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"> install ntp ntpdate </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">-</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">y</span></li></ol></pre><h4 style="border: 0px; line-height: 24px; margin: 0px 0px 18px; padding: 0px; vertical-align: baseline;"><span face="-apple-system, system-ui, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif"><span style="background-color: white;">CentOS/RHEL系统</span></span></h4><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"><li class="L0" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">yum install ntp ntpdate </span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">-</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">y</span></li></ol></pre><h3><span class="ez-toc-section" id="%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%85%88%E5%81%9C%E6%AD%A2NTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%86%8D%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E3%80%82" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"></span></h3><p style="background-color: white; border: 0px; line-height: 28px; margin: 0px 0px 20px; padding: 0px; text-align: left; vertical-align: baseline;"><span face="-apple-system, system-ui, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif"><span style="font-size: 20px; font-weight: normal;">接下来我们需要先停止NTP服务器，再更新时间。</span></span></p><div><br /></div><pre class="prettyprint linenums prettyprinted"><ol class="linenums" style="border: 0px; color: #656d78; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"><li class="L0" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">service ntpd stop                 </span><span class="com" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">#停止ntp服务</span></li><li class="L1" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">ntpdate us</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">pool</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">ntp</span><span class="pun" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">org           </span><span class="com" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">#同步ntp时间</span></li><li class="L2" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px 0px 0px 0.5em; vertical-align: baseline;"><span class="pln" style="border: 0px; color: #e6e9ed; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">service ntpd start                </span><span class="com" style="border: 0px; font-family: inherit; font-style: inherit; font-weight: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">#启动ntp服务</span></li></ol></pre><p>执行完成后，VPS上就是相对精确的时间设置了。</p><div><div>&nbsp; &nbsp; sudo apt-get update</div></div><div><div>&nbsp; &nbsp; sudo apt-get upgrade</div></div><div><br /></div><div>4. 最后运行下lnmp脚本，(如果需要的话可以先使用screen命令，这些lnmp.org上都有，以免网络不稳定掉线或者电脑休眠导致的安装停止)，然后睡很长的一觉，起来就完成了。 后续配置也是水到渠成了。<a href="https://lnmp.org/faq/lnmp-software-list.html" target="_blank">LNMP安装了哪些软件？安装目录在哪？</a></div><div><br /></div><div>防火墙命令 :</div><div>别忘了添加ssh端口，配置完成了再重启或者断开链接！</div><div>ubuntu防火墙： ufw allow port/tcp 端口范围：ufw allow 6000:7000/tcp</div><div><div><span style="font-size: x-small;">禁用UFW的IPV6: sudo vi /etc/default/ufw&nbsp;</span><span style="font-size: x-small;">IPV6=yes 更改为 IPV6=no</span></div></div><div>centos防火墙：<a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7</a></div><div><a href="https://www.csdn.net/tags/MtTaMg1sMDY3NzIzLWJsb2cO0O0O.html" target="_blank">https://www.csdn.net/tags/MtTaMg1sMDY3NzIzLWJsb2cO0O0O.html</a><br /></div><div><ol style="background-color: #081b4b; color: white; font-family: monospace, monospace; font-size: 14px; margin: 0px; padding: 0px;"><li style="margin: 0px; padding: 0px; white-space: pre;"><span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">sudo</span> yum <span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">install</span> firewalld</li><li style="margin: 0px; padding: 0px; white-space: pre;"><span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">sudo</span> systemctl <span class="token builtin class-name" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">enable</span> firewalld</li></ol></div><div><ol style="background-color: #081b4b; color: white; font-family: monospace, monospace; font-size: 14px; margin: 0px; padding: 0px;"><li style="margin: 0px; padding: 0px; white-space: pre;"><span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">sudo</span> firewall-cmd --zone<span class="token operator" style="background: none; border-radius: 0px; color: #eff2fb; display: inline; margin: 0px; padding: 0px;">=</span>public --add-port<span class="token operator" style="background: none; border-radius: 0px; color: #eff2fb; display: inline; margin: 0px; padding: 0px;">=</span><span class="token number" style="background: none; border-radius: 0px; color: #00c6ff; display: inline; margin: 0px; padding: 0px;">5000</span>/tcp  --permanent</li><li style="margin: 0px; padding: 0px; white-space: pre;"><span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">sudo</span> firewall-cmd --zone<span class="token operator" style="background: none; border-radius: 0px; color: #eff2fb; display: inline; margin: 0px; padding: 0px;">=</span>public --add-port<span class="token operator" style="background: none; border-radius: 0px; color: #eff2fb; display: inline; margin: 0px; padding: 0px;">=</span><span class="token number" style="background: none; border-radius: 0px; color: #00c6ff; display: inline; margin: 0px; padding: 0px;">80</span>/tcp  --permanent</li><li style="margin: 0px; padding: 0px; white-space: pre;"><span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">sudo</span> firewall-cmd --zone<span class="token operator" style="background: none; border-radius: 0px; color: #eff2fb; display: inline; margin: 0px; padding: 0px;">=</span>public --add-port<span class="token operator" style="background: none; border-radius: 0px; color: #eff2fb; display: inline; margin: 0px; padding: 0px;">=</span><span class="token number" style="background: none; border-radius: 0px; color: #00c6ff; display: inline; margin: 0px; padding: 0px;">443</span>/tcp  --permanent</li><li style="margin: 0px; padding: 0px; white-space: pre;"><span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">sudo</span> <span class="token function" style="background: none; border-radius: 0px; color: #ff4084; display: inline; margin: 0px; padding: 0px;">reboot</span></li></ol></div><div>但是说，我半年前前有写一篇文章(写了一半删了)，来寻找代替宝塔的软件，但并没有，其实宝塔的Web是完全没软件能代替的，不管国内外，其实国人做的软件有很多也是精益求精的。可惜政策/执行原因，现在也没什么可以留念的，抛弃了。</div><div><br /></div><div>最后，其实完全不必那么复杂。。。</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://m.media-amazon.com/images/I/51pa7Ng3x2L._AC_SX679_.jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="316" src="https://m.media-amazon.com/images/I/51pa7Ng3x2L._AC_SX679_.jpg" width="679" /></a></div><br /><div><br /></div><div>而且我刷了几次，那个读卡器已经报废了。</div><div><br /></div>