---
date: '2022-10-31T00:08:00.023+01:00'
description: ''
published: true
slug: 2022-10-ip
tags:
- http://schemas.google.com/blogger/2008/kind#post
- legacy-blogger
time_to_read: 5
title: "\u81EA\u7B7E\u540D\u5168\u5E73\u53F0\u901A\u7528\u7684IP\u8BC1\u4E66"
---

*This was originally posted on blogger [here](https://sheng-jiang.blogspot.com/2022/10/ip.html)*.

<p>&nbsp;前言：由于阿里云的限制，所有带域名的，不管有没有SSL，都无法逃过被拦截，所以可以用IP+域名的方式访问。之前有介绍过IP+PORT转发到DENO和CLOUDFLARE。但是我拿来下文件看视频肯定是会被DENO发现的，所以还是直接访问阿里云为妙，这样延迟也能低点。再者，之前http都是明文传输，我可不想被管理员看见，毕竟我已经见识过他们的技术力了。</p><p>&nbsp;效果：</p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6PdNr1C1Vr65MQNi3x3TX1P8DOca8QVd_hXSwSH3iENVKqBg-3356u66aMl1DEyzpbGTtfC_20CXZbJNxxWJITt8VUGVJiWf68zXwSd8XhodgPG1LE2RelJSvbstZK2-zwCCK4Ljpy9O9uAZsdSs7LQPEhKnyI7Jk37vKCnRy1pvURF1frVNqJPAn/s1340/ios-1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="249" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh6PdNr1C1Vr65MQNi3x3TX1P8DOca8QVd_hXSwSH3iENVKqBg-3356u66aMl1DEyzpbGTtfC_20CXZbJNxxWJITt8VUGVJiWf68zXwSd8XhodgPG1LE2RelJSvbstZK2-zwCCK4Ljpy9O9uAZsdSs7LQPEhKnyI7Jk37vKCnRy1pvURF1frVNqJPAn/w122-h249/ios-1.png" width="122" /></a><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilxa2CoSX_k5TmTA68G3FKBf0dyIX4Wzq7HqWQlp6DgfWO_blmlivXyLiIS5MPqie2waYmGZlzG_8pjc-84pchHtRE9VOSryHYdIAB4IDMkaGjSzvTIBj_vhG8vkGKolsAhGVTXhgewtZCSZXTRynChOeSxImN_2-MSCVvicPy-h5IxWc5PmOv4WBS/s1344/ios-2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilxa2CoSX_k5TmTA68G3FKBf0dyIX4Wzq7HqWQlp6DgfWO_blmlivXyLiIS5MPqie2waYmGZlzG_8pjc-84pchHtRE9VOSryHYdIAB4IDMkaGjSzvTIBj_vhG8vkGKolsAhGVTXhgewtZCSZXTRynChOeSxImN_2-MSCVvicPy-h5IxWc5PmOv4WBS/s320/ios-2.png" width="152" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi5aMLjHVMzI0gnQI8iGGr6JSMAlZQeAXRcSeSQppT1pCQVC1MY3PsZpnQJGQPe2EESOaGjLqiFHJjOWAgg3dR1kOveMcwzBgGs9bJT4WTogfo_kBVyZxhJREVdy4d4NOH9rkAiZ10xkHs_-u7xAv9h-o1nEN33B6nVnJw0Pr8HkM853T_EvjkjyT55/s644/Android-1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="201" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi5aMLjHVMzI0gnQI8iGGr6JSMAlZQeAXRcSeSQppT1pCQVC1MY3PsZpnQJGQPe2EESOaGjLqiFHJjOWAgg3dR1kOveMcwzBgGs9bJT4WTogfo_kBVyZxhJREVdy4d4NOH9rkAiZ10xkHs_-u7xAv9h-o1nEN33B6nVnJw0Pr8HkM853T_EvjkjyT55/w183-h201/Android-1.png" width="183" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivx21WM7HtaBJC050vx346z7MCtD5aoQ5H3GmG8Q2lgQ76SVMe8X8A_krEiRz4xQJBIni6y-Z9w_pRzFZEZDmI6ymEC0lZpeKyl2-gvz0XXN4ibaHojWwwRH9f6Iam93oB_qxaO4ow1RmCDXo9K9ebNk5khYTpdGJeA4Us7D8PEBtfz_Mp-bNJz8_A/s608/Android-2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="174" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEivx21WM7HtaBJC050vx346z7MCtD5aoQ5H3GmG8Q2lgQ76SVMe8X8A_krEiRz4xQJBIni6y-Z9w_pRzFZEZDmI6ymEC0lZpeKyl2-gvz0XXN4ibaHojWwwRH9f6Iam93oB_qxaO4ow1RmCDXo9K9ebNk5khYTpdGJeA4Us7D8PEBtfz_Mp-bNJz8_A/w175-h174/Android-2.png" width="175" /></a></div></div><p>以下教程这段，我参考了：</p><p>1. openssl为IP签发证书（支持多IP/内外网）&nbsp;<a href="https://www.jianshu.com/p/cad3377692c9" target="_blank">https://www.jianshu.com/p/cad3377692c9</a></p><p>2.&nbsp;Install self-signed certificates no longer working in Android Q&nbsp;<a href="https://stackoverflow.com/questions/58500892/install-self-signed-certificates-no-longer-working-in-android-q#:~:text=A%20private%20key%20is%20NOT,certificate%20AFTER%20it%20is%20generated." target="_blank">https://stackoverflow.com/questions/58500892/install-self-signed-certificates-no-longer-working-in-android-q#:~:text=A%20private%20key%20is%20NOT,certificate%20AFTER%20it%20is%20generated.</a></p><p>3. One self-signed cert to rule them all? Chrome, Android, and iOS&nbsp;<a href="https://stackoverflow.com/questions/57565665/one-self-signed-cert-to-rule-them-all-chrome-android-and-ios" target="_blank">https://stackoverflow.com/questions/57565665/one-self-signed-cert-to-rule-them-all-chrome-android-and-ios</a></p><p><span style="font-size: x-small;">主要是靠第三篇。</span></p><p><span style="font-size: medium;">关于IP签名适用于Windows和Mac的可以直接参考第一篇。</span></p><p><span style="font-size: medium;">关于域名签名适用于全平台的，参考第三篇。</span></p><p><span style="color: red;">如果要让第三篇适用于IP证书，把所有的<i> </i></span><i><b style="color: red;">DNS:test.com</b><span style="color: red;"> 换成</span></i><b><span style="color: red;"><i> IP:你的IP </i></span><span style="font-size: x-small;">（这一步我卡了很久）</span></b></p><p><span style="color: red;">在最后加上<b><i>[ alt_names ] IP.1=你的IP。</i></b></span></p><pre class="default s-code-block"><code class="hljs language-ini" style="border: 0px; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"><span><span color="rgba(0, 0, 0, 0)" style="font-family: inherit;"><span style="font-style: inherit; font-weight: inherit; white-space: inherit;"><br /></span></span><span style="color: #ba0000; font-family: Times;">Contents of openssl.cnf (⚠️可以翻动):</span><span style="color: #2b00fe; font-family: Times; font-size: xx-small;"><br /></span></span></code></pre><pre class="default s-code-block"><span style="color: #2b00fe; font-family: Times; font-size: xx-small;">[ req ]<br />default_bits        = 2048<br />default_keyfile     = ca.key<br />default_md          = sha256<br />default_days        = 825<br />encrypt_key         = no<br />distinguished_name  = subject<br />req_extensions      = req_ext<br />x509_extensions     = x509_ext<br />string_mask         = utf8only<br />prompt              = no<br /><br />[ subject ]<br />countryName                 = US<br />stateOrProvinceName         = Oklahoma<br />localityName                = Stillwater<br />organizationName            = My Company<br />OU                          = Engineering<br /><br />commonName              = </span><span style="color: #ff00fe; font-family: Times; font-size: xx-small;">你的IP</span><span style="color: #2b00fe; font-family: Times; font-size: xx-small;"><br />emailAddress            = me@home.com<br /><br /># Section x509_ext is used when generating a self-signed certificate. I.e., openssl req -x509 ...<br /><br />[ x509_ext ]<br />subjectKeyIdentifier      = hash<br />authorityKeyIdentifier    = keyid:always,issuer<br /><br />basicConstraints        = critical, CA:TRUE<br />keyUsage            = critical, digitalSignature, keyEncipherment, cRLSign, keyCertSign<br />subjectAltName          = </span><span style="color: #ff00fe; font-family: Times; font-size: xx-small;">IP:你的IP</span><span style="color: #2b00fe; font-family: Times; font-size: xx-small;"><br />extendedKeyUsage = serverAuth<br /><br /><br />extendedKeyUsage    = TLS Web Server Authentication<br /><br />[ req_ext ]<br />subjectKeyIdentifier        = hash<br />basicConstraints        = CA:FALSE<br />keyUsage            = digitalSignature, keyEncipherment<br />subjectAltName          = </span><span style="color: #ff00fe; font-family: Times; font-size: xx-small;">IP:你的IP</span><span style="color: #2b00fe; font-family: Times; font-size: xx-small;"><br /><br />nsComment           = "OpenSSL Generated Certificate"<br />[alt_names}<br />IP.1=</span><span style="color: #ff00fe; font-family: Times; font-size: xx-small;">你的IP</span></pre><pre class="default s-code-block"><code class="hljs language-ini" style="border: 0px; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"><span><pre class="default s-code-block"><br /></pre></span></code></pre><pre class="default s-code-block"><br /></pre><p><span style="color: red;"></span></p><pre class="default s-code-block"><code class="hljs language-csharp">然后用命令生成就行：</code></pre><pre class="default s-code-block"><code class="hljs language-csharp">openssl req -config openssl.cnf -<span class="hljs-keyword" color="var(--highlight-keyword)" style="border: 0px; font-family: inherit; font-size: 13px; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">new</span> -x509 -days <span class="hljs-number" color="var(--highlight-namespace)" style="border: 0px; font-family: inherit; font-size: 13px; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">825</span> -<span class="hljs-keyword" color="var(--highlight-keyword)" style="border: 0px; font-family: inherit; font-size: 13px; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">out</span> ca.crt<br /></code></pre><div><code class="hljs language-csharp"><pre class="default s-code-block"><code class="hljs language-scss">openssl x509 -in ca<span class="hljs-selector-class" color="var(--highlight-keyword)" style="border: 0px; font-family: inherit; font-size: 13px; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;">.crt</span> -text -noout<br /></code></pre><div><code class="hljs language-scss"><br /></code></div></code></div><p>- 其它的问题不大。最后导入还是挺方便的。导入.CRT就行, IOS稍微麻烦点。</p><p>在 Debian / Ubuntu / Alpine 系统中信任证书:&nbsp;</p><p>cp *.crt /usr/local/share/ca-certificates/</p><p>update-ca-certificates</p><p><br /></p><p>- 关于nginx配置&nbsp;</p><p>ssl_certificate /home/ssl/xxx/ca.<b>crt</b>;</p><p>ssl_certificate_key /home/ssl/xxx/ca.<b>key</b>;</p><p>- 关于安全</p><p>但是nps从家里到阿里云那段应该没有加密。据说现在但凡是个高级点的路由都有识别功能了，但是无所谓了。我只是不想让学校管理员看到我在nas上看的那些PT。你知道这国外的技术有多高超，所有电脑账号都是拿学号登录的，桌面的文件都是同步的，Windows的登录感觉是在线验证，我国内从来没见识过。用户没有管理员，无法U盘启动，BIOS有密码，真是全面加固啊。我上网的时候，经常来给我提示，好多网站都禁了。就怕群晖有什么漏洞，给我来个勒索病毒。那个nps的漏洞就是无法进shell，造不成什么影响。</p><p>这个SSL也有好多公司靠着赚钱的，互联网也是这样，压根就依附于域名，dns，服务器，运营商的链路。完全不在掌控之内。</p><p>关于nps，目前所知nps-auth-bypass的漏洞，我把阿里云上的修复了，但是由于种种原因换掉nps还是算了。</p><p>关于这个漏洞：</p><p><a href="https://jireh.xyz/articles/2022/08/10/1660122191957.html" target="_blank">https://jireh.xyz/articles/2022/08/10/1660122191957.html</a></p><p><a href="https://github.com/carr0t2/nps-auth-bypass" target="_blank">https://github.com/carr0t2/nps-auth-bypass</a><br /></p>