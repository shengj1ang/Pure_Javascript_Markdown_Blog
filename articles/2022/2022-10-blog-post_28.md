---
date: '2022-10-22T14:51:00.010+01:00'
description: ''
published: true
slug: 2022-10-blog-post_28
tags:
- http://schemas.google.com/blogger/2008/kind#post
- legacy-blogger
time_to_read: 5
title: "\u5FAE\u5E97\u8865\u8D27\u901A\u77E5\u5927\u83B7\u5168\u80DC"
---

*This was originally posted on blogger [here](https://sheng-jiang.blogspot.com/2022/10/blog-post_28.html)*.

<p>&nbsp;前言：好几周前，BIGDONGDONG开始分享他的emby库，账号在微店上获得，但是前几次直播人气太旺，那就只能利用机器的力量在补货的时候通知我了。</p><p>20221029: 之前那篇标题里有“监控”违反TOS了，重新换个新文章吧。</p><p>方法：<span style="font-size: xx-small;">BIGDONGDONG的微店《=ProxyAPI（防止反爬虫）《=Python Requests =》Telegram Api（Proxy，通过Works转发API，以达到国内服务器访问的目的）</span></p><p>效果：</p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiXPMynV_eGF4y_n4f4EPRRoAnwjYuzvls5VdlfeaCcHR_NCW_FUuAEWkHibMFXGz6kNJht1ll9KrZN0CKFSi4O76tb1dACr2GN5VfUalOxhxFfeu_GcnMtsCmYeeGsG8QWeBfkAJQjsU0BurR6eVosjIP1SwKAdEp4EgsSnED0-A0Nw-Y6HIQVqhUJ/s948/telegram.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="288" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiXPMynV_eGF4y_n4f4EPRRoAnwjYuzvls5VdlfeaCcHR_NCW_FUuAEWkHibMFXGz6kNJht1ll9KrZN0CKFSi4O76tb1dACr2GN5VfUalOxhxFfeu_GcnMtsCmYeeGsG8QWeBfkAJQjsU0BurR6eVosjIP1SwKAdEp4EgsSnED0-A0Nw-Y6HIQVqhUJ/s320/telegram.png" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRJPAIXNOxk9Yq9bp27Wumf0yI3GSg_KR_1ueN22yRtk_96oKGqWU9COhYnzqjUOm3ntFJo4pvfpvoU8zx6OJLYd-UaQtLmge-GveXFWADKFeLvCLp5GUSvKdS2mfiZnC7fTrtazQ_jq-6pFGLaCFF0kEU_in1d7jMLCfF5LnSBG26S71oA7pj9sro/s636/sms.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="86" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRJPAIXNOxk9Yq9bp27Wumf0yI3GSg_KR_1ueN22yRtk_96oKGqWU9COhYnzqjUOm3ntFJo4pvfpvoU8zx6OJLYd-UaQtLmge-GveXFWADKFeLvCLp5GUSvKdS2mfiZnC7fTrtazQ_jq-6pFGLaCFF0kEU_in1d7jMLCfF5LnSBG26S71oA7pj9sro/s320/sms.png" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><p>实现：重点展示Requests部分，其它的都是前期的项目。其实经过实践，微店并没有禁止同IP的疯狂抓取。</p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh0zwqNj5PCgDRK3gw0gpA1qc5x_oemSRZ2rVzcM_goIA64D6RUKAHOaDSC0m6LEYjEGfPJdeklRNAcQknVnUbzUoM75thIJOG31TNbSs_Lgw95G1G4KtTkq58nSApgUU2nFD0SYWZqaEUdNsAISRlrM_pwot-gEAEFtMtrtl12XXnr5c-wxRMnfr2N/s1294/Screenshot%202022-10-28%20at%2011.17.54%20PM.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="204" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh0zwqNj5PCgDRK3gw0gpA1qc5x_oemSRZ2rVzcM_goIA64D6RUKAHOaDSC0m6LEYjEGfPJdeklRNAcQknVnUbzUoM75thIJOG31TNbSs_Lgw95G1G4KtTkq58nSApgUU2nFD0SYWZqaEUdNsAISRlrM_pwot-gEAEFtMtrtl12XXnr5c-wxRMnfr2N/s320/Screenshot%202022-10-28%20at%2011.17.54%20PM.png" width="320" /></a></div><br /><p></p><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><p>最后贴下code: 小脚本就不传GitHub了😂 注意缩进，</p><p>&nbsp; &nbsp;以下发法是：<span style="font-size: x-small;">BIGDONGDONG的微店《=Python Requests =》Telegram Api（需要代理访问）</span>。</p><p>import requests</p><p>import time</p><p>import random</p><p>from time import gmtime, strftime</p><p>import sys</p><p>def timenow():</p><p>&nbsp; &nbsp; return(strftime("%Y-%m-%d %H:%M:%S", gmtime()))</p><p>def TG_Bot_GetMe(bot):</p><p>&nbsp; &nbsp; r=requests.get("https://api.telegram.org/bot{}/GetMe".format(str(bot)))</p><p>&nbsp; &nbsp; return (r.content.decode())</p><p>def TG_Bot_GetUpdates(bot):</p><p>&nbsp; &nbsp; r=requests.get("https://api.telegram.org/bot{}/getupdates".format(str(bot)))</p><p>&nbsp; &nbsp; return (r.content.decode())&nbsp; &nbsp;&nbsp;</p><p>def TG_Bot_SendMessage(bot,chat_id,text):</p><p>&nbsp; &nbsp; r=requests.get("https://api.telegram.org/bot{}/sendMessage?chat_id={}&amp;text={}".format(str(bot),str(chat_id),str(text)))</p><p>&nbsp; &nbsp; return(r.content.decode())</p><p>user_agent = {'User-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36'}</p><p>#https://shop1851686128.v.weidian.com/?userid=1851686128</p><p>bot="这里需要改成你自己的Bot ID"</p><p>tg_chat_id="通过GetUpdate可以获取chat_id"</p><p>errors=0</p><p>last_status=""</p><p>print(TG_Bot_GetMe(bot))</p><p>print(TG_Bot_GetUpdates(bot))</p><p><br /></p><p>if sys.argv[1]=="1":</p><p>&nbsp; &nbsp; print(TG_Bot_SendMessage(bot,tg_chat_id,'【Monitor】 {} \nBIGDONGDONG Emby Monitor is enabled now.'.format(str(timenow()))))</p><p><br /></p><p>while True:</p><p>&nbsp; &nbsp; try:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; t=random.randint(10,30)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; print("[{}] Sleep For {} seconds".format(timenow(),str(t)))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; time.sleep(t)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; try:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r = requests.get('https://shop1851686128.v.weidian.com/item.html?itemID=5593028522',headers=user_agent)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; except Exception as ex:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(ex)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if str(r.content).find("sell-out wd-theme__disabled-button1")!=-1:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print("[{}] Sell Out".format(timenow()))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; elif str(r.content).find("sold-out wd-theme__disabled-button1")!=-1:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print("[{}] 商品已下架".format(timenow()))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; elif str(r.content).find("buy-now wd-theme__button1")!=-1:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print("[{}] Buy Now !!!".format(timenow()))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TG_Bot_SendMessage(bot,tg_chat_id,'【Monitor】 {} \nBIGDONGDONG Emby is avaliable now, buy it here https://shop1851686128.v.weidian.com/?userid=1851686128'.format(str(timenow())))</p><p><br /></p><p>&nbsp; &nbsp; &nbsp; &nbsp; else:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(r.content.decode())</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if errors&gt;=10:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(TG_Bot_SendMessage(bot,tg_chat_id,'【Monitor】 {} \nBIGDONGDONG Emby Monitor is disabled now. \nError Info: Reach The Maximum Error Number: {}'.format(str(timenow()),str(errors))))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sys.exit()</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errors+=1</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(str(errors)+" Error(s)")</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pass</p><p>&nbsp; &nbsp; except Exception as ex:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; print(TG_Bot_SendMessage(bot,tg_chat_id,'【Monitor】 {} \nBIGDONGDONG Emby Monitor is disabled now. \nError Info: {}'.format(str(timenow()),str(ex))))</p><pre><br /></pre><pre>20221015补充</pre><div style="border: 0px; margin-top: 0px; overflow: auto; vertical-align: baseline; width: auto;">由于这个Emby无法在海外访问，所以刚开始我刚开始用的shadowsocks翻回去，另一篇文章还讲了风流，但是由于这个代理是开在电脑上的，所以用起来不是很爽。最重要的是在浏览器里很多影片是放了没声音，所以只能下载客户端（Terminus Player，这个免费，支持Win&amp;Mac），但是客户端没有地方配置代理，所以现在我那阿里云国内的机器做了反向代理。</div><pre><br /></pre><pre>下面是Nginx的反代部分的配置</pre><pre>      location ^~ / {<br />             proxy_pass http://media.xxx.com:8096;<br />             proxy_set_header Host "media.xxx.com";<br />             proxy_set_header Referer "http://media.xxx.com:8096/";<br />             proxy_set_header User-Agent $http_user_agent;<br />             #proxy_set_header Host $proxy_host; <br />   <span>&nbsp;&nbsp; &nbsp;</span><span>&nbsp;&nbsp; &nbsp;  </span>#proxy_set_header  X-Real-IP  $remote_addr;<br />   <span>&nbsp;&nbsp; &nbsp;</span><span>&nbsp;&nbsp; &nbsp;</span><span>&nbsp;&nbsp;</span>#proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;<br />    <span>&nbsp;&nbsp; &nbsp;</span><span>&nbsp;&nbsp; &nbsp; </span>#proxy_set_header X-NginX-Proxy true;<br />         }<br /></pre><div><br /></div><pre>为了让BDD那边不会有什么异常，我还特意了解下Nginx的参数传递，<a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/" target="_blank">https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/</a></pre><pre><a href="https://www.cpming.top/p/nginx-proxy-pass-google-website" target="_blank">Linux 下利用 Nginx 反向代理 </a><br /></pre><pre><br /></pre><pre><br /></pre><pre><br /></pre><pre><br /></pre>